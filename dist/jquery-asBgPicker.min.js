/*! jQuery asBgPicker - v0.1.0 - 2014-07-04
* https://github.com/amazingSurge/jquery-asBgPicker
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a,b,c,d){"use strict";var e="asBgPicker",f=a[e]=function(b,c){this.element=b,this.$element=a(b),this.options=a.extend({},f.defaults,c,this.$element.data()),this.namespace=this.options.namespace,this.classes={skin:this.namespace+"_"+this.options.skin,disabled:this.namespace+"_disabled",active:this.namespace+"_active",hide:this.namespace+"_hide",show:this.namespace+"_show",hasImage:this.namespace+"_hasImage"},this.disabled=!1,this.initialed=!1;var e=this;a.extend(e,{init:function(){e._createHtml(),e.options.skin&&e.$wrap.addClass(e.classes.skin),e.value=this.options.parse(this.$element.val()),e.set(e.value,!1),e.options.disabled&&e.disable(),e.value.image&&e.setImage(e.value.image),e.doSize.init(),e.doAttachment.init(),e.doPosition.init(),e.doRepeat.init(),e._bindEvent(),e.initialed=!0,e._trigger("ready")},_bindEvent:function(){e.$initiate.on("mouseenter",function(){e.disabled||(e.$actions.addClass(e.classes.show),e.$remove.addClass(e.classes.show))}).on("mouseleave",function(){e.disabled||(e.$actions.removeClass(e.classes.show),e.$remove.removeClass(e.classes.show))}),e.$actions.on("click",function(){e.disabled||(e.$initiate.addClass(e.classes.hide),e.$wrap.append(e.$extend),e.$extend.removeClass(e.classes.hide).addClass(e.classes.show))}),e.$remove.on("click",function(a){return a.preventDefault(),e.disabled?void 0:(e.clear(),!1)}),e.$close.on("click",function(){return e.disabled?void 0:(e.$extend.removeClass(e.classes.show).addClass(e.classes.hide),e.$initiate.removeClass(e.classes.hide),!1)}),e.$element.on("onChange",function(){e.disabled||e.options.onChange.call(e)}),e.$image.on("click",function(){e.disabled||e.options.select.call(e)})},_createHtml:function(){e.$wrap=a(e.options.tpl()),e.$extend=a(e.options.tpl_extend()),e.$element.after(e.$wrap),e.$initiate=e.$wrap.find("."+e.namespace+"-initiate"),e.$info=e.$initiate.find("."+e.namespace+"-image-info"),e.$remove=e.$wrap.find("."+e.namespace+"-remove"),e.$actions=e.$wrap.find("."+e.namespace+"-actions"),e.$close=e.$extend.find("."+e.namespace+"-close"),e.$image_wrap=e.$extend.find("."+e.namespace+"-image-wrap"),e.$image=e.$extend.find("."+e.namespace+"-image")},_trigger:function(a){e.$element.trigger("asBgPicker::"+a,e),e.$element.trigger(a+".asBgPicker",e),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var b="on"+a,c=arguments.length>1?Array.prototype.slice.call(arguments,1):d;"function"==typeof e.options[b]&&e.options[b].apply(e,c)},_setState:function(a){a&&a!==e.options.image?e.$initiate.addClass(e.classes.hasImage):e.$initiate.removeClass(e.classes.hasImage)},_returnInfo:function(b){var c;b&&b!==e.options.image?(c=b.match(/([\S]+[\/])([\S]+\w+$)/i)[2],a(e.$info)[0].lastChild.nodeValue=c):a(e.$info)[0].lastChild.nodeValue="Add Image"},_update:function(){null===e.value&&(e.value={}),e.$element.val(e.val()),e._trigger("change",e.val())},doRepeat:{values:e.options.repeat.values,default_value:e.options.repeat.default_value,init:function(){var b=this,c=e.options.repeat.tpl().replace(/namespace/g,e.namespace);this.$tpl_repeat=a(c),e.$image_wrap.after(this.$tpl_repeat),this.$repeat=e.$extend.find("."+e.namespace+"-repeat"),this.$items=this.$repeat.find("li"),a.each(this.values,function(a,c){b.$items.eq(a).data("repeat",c)});var d="undefined"!=typeof e.value.repeat?e.value.repeat:this.default_value;this.set(d),this.bindEvent()},set:function(a){var b=!1;this.$items.removeClass(e.classes.active);for(var c=0;c<this.values.length;c++)a===this.values[c]&&(e.value.repeat=a,this.$items.eq(c).addClass(e.classes.active),e.$image.css({"background-repeat":a}),b=!0);b||this.set(this.default_value)},clear:function(){this.set(this.default_value)},bindEvent:function(){var b=this;this.$repeat.on("click","li",function(){if(!e.disabled){var c=a(this).data("repeat");return b.set(c),e._update(),!1}})}},doPosition:{values:e.options.position.values,default_value:e.options.position.default_value,init:function(){var b=this,c=e.options.position.tpl().replace(/namespace/g,e.namespace);this.$tpl_position=a(c),e.$image_wrap.after(this.$tpl_position),this.$position=e.$extend.find("."+e.namespace+"-position"),this.$items=this.$position.find("li"),a.each(this.values,function(a,c){b.$items.eq(a).data("position",c)});var d="undefined"!=typeof e.value.position?e.value.position:this.default_value;this.set(d),this.bindEvent()},set:function(a){var b=!1;this.$items.removeClass(e.classes.active);for(var c=0;c<this.values.length;c++)a===this.values[c]&&(e.value.position=a,this.$items.eq(c).addClass(e.classes.active),e.$image.css({"background-position":a}),b=!0);b||this.set(this.default_value)},clear:function(){this.set(this.default_value)},bindEvent:function(){var b=this;this.$position.on("click","li",function(){if(!e.disabled){var c=a(this).data("position");return b.set(c),e._update(),!1}})}},doSize:{values:e.options.size.values,default_value:e.options.size.default_value,init:function(){var b=this,c=e.options.size.tpl().replace(/namespace/g,e.namespace);this.$tpl_size=a(c),e.$image_wrap.after(this.$tpl_size),this.$size=e.$extend.find("."+e.namespace+"-size"),this.$items=this.$size.find("li"),a.each(this.values,function(a,c){b.$items.eq(a).data("size",c)});var d="undefined"!=typeof e.value.size?e.value.size:this.default_value;this.set(d),this.bindEvent()},set:function(a){var b=!1;this.$items.removeClass(e.classes.active);for(var c=0;c<this.values.length;c++)a===this.values[c]&&(e.value.size=a,this.$items.eq(c).addClass(e.classes.active),e.$image.css({"background-size":a}),b=!0);b||this.set(this.default_value)},clear:function(){this.set(this.default_value)},bindEvent:function(){var b=this;this.$size.on("click","li",function(){if(!e.disabled){var c=a(this).data("size");return b.set(c),e._update(),!1}})}},doAttachment:{values:e.options.attachment.values,default_value:e.options.attachment.default_value,init:function(){var b=this,c=e.options.attachment.tpl().replace(/otherNamespace/g,e.options.attachment.namespace).replace(/namespace/g,e.namespace);this.$tpl_attachment=a(c),e.$image_wrap.after(this.$tpl_attachment),this.$attachment=e.$extend.find("."+e.namespace+"-attachment"),this.$items=this.$attachment.find("li"),this.$dropdown=e.$extend.find("."+e.options.attachment.namespace),this.values=e.options.attachment.values,a.each(this.values,function(a,c){b.$items.eq(a).data("attachment",c)}),this.$dropdown.asDropdown({namespace:e.options.attachment.namespace,imitateSelect:!0,data:"attachment",onChange:function(a){e.disabled||(e.value.attachment=a,e._update(),e.$image.css({"background-attachment":e.value.attachment}))}});var d="undefined"!=typeof e.value.attachment?e.value.attachment:this.default_value;this.set(d)},set:function(a){var b=!1;this.$items.removeClass(e.classes.active);for(var c=0;c<this.values.length;c++)a===this.values[c]&&(this.$dropdown.data("asDropdown").set(a),b=!0);b||this.set(this.default_value)},clear:function(){this.set(this.default_value)}}}),this._trigger("init"),this.init()};f.prototype={constructor:f,val:function(a){if("undefined"==typeof a)return this.options.process(this.value);var b=this.options.parse(a);b?this.set(b):this.clear()},set:function(a,b){this.value=a,b!==!1&&(this.setImage("undefined"!=typeof a.image?a.image:""),"undefined"!=typeof a.repeat?this.doRepeat.set(a.repeat):this.doRepeat.clear(),"undefined"!=typeof a.size?this.doSize.set(a.size):this.doSize.clear(),"undefined"!=typeof a.position?this.doPosition.set(a.position):this.doPosition.clear(),"undefined"!=typeof a.attachment?this.doAttachment.set(a.attachment):this.doAttachment.clear(),this._update())},clear:function(a){if(this.value={},a!==!1){var b="";this.setImage(b),this.doRepeat.clear(),this.doSize.clear(),this.doPosition.clear(),this.doAttachment.clear(),this._update()}},setImage:function(a){var b,c=this;if(c._setState(a),c._returnInfo(a),""===a||"undefined"==typeof a)c.$image.css({"background-image":"none"});else if(a||a!==c.options.image){b=c.options.getThumbnalil(a);var d=new Image;d.onload=function(){c.value.image=b,c._returnInfo(c.value.image),c._update(),c.$image.css({"background-image":'url("'+c.value.image+'")'})},d.onerror=function(){c.value.image=a,c._returnInfo(a),c._update(),c.$image.css({"background-image":"none"})},d.src=b}},setRepeat:function(a){this.doRepeat.set(a),this._update()},setSize:function(a){this.doSize.set(a),this._update()},setPosition:function(a){this.doPosition.set(a),this._update()},setAttachment:function(a){this.doAttachment.set(a),this._update()},enable:function(){this.disabled=!1,this.$wrap.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrap.addClass(this.classes.disabled)},destory:function(){this.$element.data(e,null),this.$wrap.remove(),this._trigger("destory")}},f.defaults={namespace:e,skin:null,image:"images/defaults.png",repeat:{default_value:"repeat",values:["no-repeat","repeat","repeat-x","repeat-y"],tpl:function(){return'<div class="namespace-repeat"><span class="namespace-repeat-title">Repeat</span><ul class="namespace-repeat-content"><li class="repeat_no-repeat"></li><li class="repeat_repeat"></li><li class="repeat_repeat-x"></li><li class="repeat_repeat-y"></li></ul></div>'}},position:{default_value:"top left",values:["top left","top center","top right","center left","center center","center right","bottom left","bottom center","bottom right"],tpl:function(){return'<div class="namespace-position"><span class="namespace-position-title">Position</span><ul class="namespace-position-content"><li class="postion_top-left"></li><li class="postion_top-center"></li><li class="postion_top-right"></li><li class="postion_center-left"></li><li class="postion_center-center"></li><li class="postion_center-right"></li><li class="postion_bottom-left"></li><li class="postion_bottom-center"></li><li class="postion_bottom-right"></li></ul></div>'}},size:{default_value:"auto",values:["auto","cover","contain","100% 100%"],tpl:function(){return'<div class="namespace-size"><span class="namespace-size-title">Scalling</span><ul class="namespace-size-content"><li class="size_adapt-auto"></li><li class="size_adapt-width"></li><li class="size_adapt-height"></li><li class="size_adapt-all"></li></ul></div>'}},attachment:{namespace:"asDropdown",default_value:"scroll",values:["scroll","fixed","inherit"],tpl:function(){return'<div class="namespace-attachment"><span class="namespace-attachment-title">Attach</span><div class="namespace-attachment-content"><div class="otherNamespace namespace-dropdown-trigger"><i class="asIcon-caret-down"></i></div><ul><li class="attachment_scroll">scroll</li><li class="attachment_fixed">fixed</li><li class="attachment_default">default</li></ul></div></div>'}},tpl:function(){return'<div class="'+this.namespace+'"><div class="'+this.namespace+'-initiate"><div class="'+this.namespace+'-image-info"><span></span>Add Image</div><div class="'+this.namespace+'-actions">Change</div><a class="'+this.namespace+'-remove" href=""></a></div></div>'},tpl_extend:function(){return'<div class="'+this.namespace+'-extend"><a class="'+this.namespace+'-close" href="#"></a><div class="'+this.namespace+'-image-wrap"><div class="'+this.namespace+'-image"></div></div></div>'},process:function(a){return a&&"undefined"!=typeof a.image&&""!==a.image?JSON.stringify(a):""},parse:function(b){return b?a.parseJSON(b):{}},getThumbnalil:function(a){var b,c,d,e;return b=a.match(/([\S]+[\/])([\S]+)(\.+\w+$)/i),c=b[1],e=b[2],d=b[3],0===e.search("thumbnail")?c+e+d:c+"thumbnail-"+e+d},select:function(){},onChange:function(){}},a.fn[e]=function(b){if("string"!=typeof b)return this.each(function(){a.data(this,e)||a.data(this,e,new f(this,b))});var c=b,g=arguments.length>1?Array.prototype.slice.call(arguments,1):d;if(/^\_/.test(c))return!1;if("val"!==c||g!==d)return this.each(function(){var b=a.data(this,e);b&&"function"==typeof b[c]&&b[c].apply(b,g)});var h=this.first().data(e);return h&&"function"==typeof h[c]?h[c].apply(h,g):void 0}}(jQuery,document,window);