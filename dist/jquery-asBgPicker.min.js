/*! jQuery asBgPicker - v0.1.1 - 2014-09-06
* https://github.com/amazingSurge/jquery-asBgPicker
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a){"use strict";var b="asBgPicker",c=a[b]=function(d,e){this.element=d,this.$element=a(d),this.options=a.extend({},c.defaults,e,this.$element.data()),this.lang="undefined"==typeof c.Strings[this.options.lang]?"en":this.options.lang,this.strings=a.extend({},c.Strings[this.lang],this.options.strings),this.namespace=this.options.namespace,this.classes={skin:this.namespace+"_"+this.options.skin,disabled:this.namespace+"_disabled",active:this.namespace+"_active",hover:this.namespace+"_hover",empty:this.namespace+"_empty",exist:this.namespace+"_exist",expand:this.namespace+"_expand"},this.disabled=!1,this.initialed=!1;var f=this;a.extend(f,{init:function(){this._createHtml(),this.options.skin&&this.$wrap.addClass(this.classes.skin),this.value=this.options.parse(this.$element.val()),this.set(this.value,!1),this.options.disabled&&this.disable(),this.value.image||this.$wrap.addClass(this.classes.empty),this.doSize.init(),this.doAttachment.init(),this.doPosition.init(),this.doRepeat.init(),this.$wrap.addClass(this.classes.exist),this._bindEvent(),this.initialed=!0,this._trigger("ready")},_bindEvent:function(){this.$initiate.on("click",function(){f.disabled||f.$wrap.addClass(f.classes.expand).removeClass(f.classes.exist)}),this.$info.on("mouseenter",function(){f.disabled||a(this).addClass(f.classes.hover)}).on("mouseleave",function(){f.disabled||a(this).removeClass(f.classes.hover)}),this.$change.on("click",function(){f.disabled||f.$wrap.addClass(f.classes.expand).removeClass(f.classes.exist)}),this.$remove.on("click",function(){return f.disabled?void 0:(f.clear(),!1)}),this.$close.on("click",function(){return f.disabled?void 0:(f.$wrap.addClass(f.classes.exist).removeClass(f.classes.expand),!1)}),this.$image.on("click",function(){f.disabled||f.options.select.call(f)})},_createHtml:function(){this.$wrap=a(this.options.tpl().replace(/\{\{namespace\}\}/g,this.namespace).replace(/\{\{strings.placeholder\}\}/g,this.strings.placeholder).replace(/\{\{strings.change\}\}/g,this.strings.change)),this.$element.after(this.$wrap),this.$initiate=a("."+this.namespace+"-initiate",this.$wrap),this.$info=a("."+this.namespace+"-info",this.$wrap),this.$info_imageName=a("."+this.namespace+"-info-image-name",this.$info),this.$remove=a("."+this.namespace+"-info-remove",this.$info),this.$change=a("."+this.namespace+"-info-change",this.$info),this.$expand=a("."+this.namespace+"-expand",this.$wrap),this.$close=a("."+this.namespace+"-expand-close",this.$expand),this.$image_wrap=a("."+this.namespace+"-expand-image-wrap",this.$expand),this.$image=a("."+this.namespace+"-expand-image",this.$expand)},_trigger:function(a){var b=Array.prototype.slice.call(arguments,1),c=[f].concat(b);f.$element.trigger("asBgPicker::"+a,c),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var d="on"+a;"function"==typeof f.options[d]&&f.options[d].apply(f,b)},_setState:function(a){a&&a!==f.options.image?f.$wrap.removeClass(f.classes.empty):f.$wrap.addClass(f.classes.empty)},_returnInfo:function(a){var b;a&&a!==f.options.image?(b=a.match(/([\S]+[\/])([\S]+\w+$)/i)[2],f.$info_imageName.text(b)):f.$info_imageName.text(f.strings.placeholder)},_update:function(){null===f.value&&(f.value={}),f.$element.val(f.val()),f._trigger("change",f.options.parse(f.val()),f.options.name,b)},doRepeat:{values:f.options.repeat.values,default_value:f.options.repeat.default_value,init:function(){var b=this,c=f.options.repeat.tpl().replace(/\{\{namespace\}\}/g,f.namespace).replace(/\{\{strings.bgRepeat\}\}/g,f.strings.bgRepeat);this.$tpl_repeat=a(c),f.$image_wrap.after(this.$tpl_repeat),this.$repeat=f.$expand.find("."+f.namespace+"-repeat"),this.$items=this.$repeat.find("li"),a.each(this.values,function(a,c){b.$items.eq(a).data("repeat",c)});var d="undefined"!=typeof f.value.repeat?f.value.repeat:this.default_value;this.set(d),this.bindEvent()},set:function(a){var b=!1;this.$items.removeClass(f.classes.active);for(var c=0;c<this.values.length;c++)a===this.values[c]&&(f.value.repeat=a,this.$items.eq(c).addClass(f.classes.active),f.$image.css({"background-repeat":a}),b=!0);b||this.set(this.default_value)},clear:function(){this.set(this.default_value)},bindEvent:function(){var b=this;this.$repeat.on("click","li",function(){if(!f.disabled){var c=a(this).data("repeat");return b.set(c),f._update(),!1}})}},doPosition:{values:f.options.position.values,default_value:f.options.position.default_value,init:function(){var b=this,c=f.options.position.tpl().replace(/\{\{namespace\}\}/g,f.namespace).replace(/\{\{strings.bgPosition\}\}/g,f.strings.bgPosition);this.$tpl_position=a(c),f.$image_wrap.after(this.$tpl_position),this.$position=f.$expand.find("."+f.namespace+"-position"),this.$items=this.$position.find("li"),a.each(this.values,function(a,c){b.$items.eq(a).data("position",c)});var d="undefined"!=typeof f.value.position?f.value.position:this.default_value;this.set(d),this.bindEvent()},set:function(a){var b=!1;this.$items.removeClass(f.classes.active);for(var c=0;c<this.values.length;c++)a===this.values[c]&&(f.value.position=a,this.$items.eq(c).addClass(f.classes.active),f.$image.css({"background-position":a}),b=!0);b||this.set(this.default_value)},clear:function(){this.set(this.default_value)},bindEvent:function(){var b=this;this.$position.on("click","li",function(){if(!f.disabled){var c=a(this).data("position");return b.set(c),f._update(),!1}})}},doSize:{values:f.options.size.values,default_value:f.options.size.default_value,init:function(){var b=this,c=f.options.size.tpl().replace(/\{\{namespace\}\}/g,f.namespace).replace(/\{\{strings.bgSize\}\}/g,f.strings.bgSize);this.$tpl_size=a(c),f.$image_wrap.after(this.$tpl_size),this.$size=f.$expand.find("."+f.namespace+"-size"),this.$items=this.$size.find("li"),a.each(this.values,function(a,c){b.$items.eq(a).data("size",c)});var d="undefined"!=typeof f.value.size?f.value.size:this.default_value;this.set(d),this.bindEvent()},set:function(a){var b=!1;this.$items.removeClass(f.classes.active);for(var c=0;c<this.values.length;c++)a===this.values[c]&&(f.value.size=a,this.$items.eq(c).addClass(f.classes.active),f.$image.css({"background-size":a}),b=!0);b||this.set(this.default_value)},clear:function(){this.set(this.default_value)},bindEvent:function(){var b=this;this.$size.on("click","li",function(){if(!f.disabled){var c=a(this).data("size");return b.set(c),f._update(),!1}})}},doAttachment:{values:f.options.attachment.values,default_value:f.options.attachment.default_value,init:function(){var b=this,c=f.options.attachment.tpl().replace(/\{\{attachNamespace\}\}/g,f.options.attachment.namespace).replace(/\{\{namespace\}\}/g,f.namespace).replace(/\{\{strings.bgAttach\}\}/g,f.strings.bgAttach);this.$tpl_attachment=a(c),f.$image_wrap.after(this.$tpl_attachment),this.$attachment=f.$expand.find("."+f.namespace+"-attachment"),this.$items=this.$attachment.find("li"),this.$dropdown=f.$expand.find("."+f.options.attachment.namespace),this.values=f.options.attachment.values,a.each(this.values,function(a,c){b.$items.eq(a).data("attachment",c)}),this.$dropdown.asDropdown({namespace:f.options.attachment.namespace,imitateSelect:!0,data:"attachment",onChange:function(a){f.disabled||(f.value.attachment=a,f._update(),f.$image.css({"background-attachment":f.value.attachment}))}});var d="undefined"!=typeof f.value.attachment?f.value.attachment:this.default_value;this.set(d)},set:function(a){var b=!1;this.$items.removeClass(f.classes.active);for(var c=0;c<this.values.length;c++)a===this.values[c]&&(this.$dropdown.data("asDropdown").set(a),b=!0);b||this.set(this.default_value)},clear:function(){this.set(this.default_value)}}}),this._trigger("init"),this.init()};c.prototype={constructor:c,val:function(a){if("undefined"==typeof a)return this.options.process(this.value);var b=this.options.parse(a);b?this.set(b):this.clear()},set:function(a,b){this.value=a,this.setImage(a.image),b!==!1&&("undefined"!=typeof a.repeat?this.doRepeat.set(a.repeat):this.doRepeat.clear(),"undefined"!=typeof a.size?this.doSize.set(a.size):this.doSize.clear(),"undefined"!=typeof a.position?this.doPosition.set(a.position):this.doPosition.clear(),"undefined"!=typeof a.attachment?this.doAttachment.set(a.attachment):this.doAttachment.clear(),this._update())},clear:function(a){if(this.value={},a!==!1){var b="";this.setImage(b),this.doRepeat.clear(),this.doSize.clear(),this.doPosition.clear(),this.doAttachment.clear(),this._update()}},setImage:function(a){var b,c=this;if(this._setState(a),this._returnInfo(a),""===a||"undefined"==typeof a)this.$image.css({"background-image":"none"});else if(a||a!==this.options.image){b=this.options.getThumbnalil(a);var d=new Image;d.onload=function(){c.value.image=b,c._returnInfo(c.value.image),c.$image.css({"background-image":'url("'+c.value.image+'")'})},d.onerror=function(){c.value.image=a,c._returnInfo(a),c._update(),c.$image.css({"background-image":"none"})},d.src=b}},setRepeat:function(a){this.doRepeat.set(a),this._update()},setSize:function(a){this.doSize.set(a),this._update()},setPosition:function(a){this.doPosition.set(a),this._update()},setAttachment:function(a){this.doAttachment.set(a),this._update()},get:function(){return this.value},enable:function(){this.disabled=!1,this.$wrap.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrap.addClass(this.classes.disabled)},destory:function(){this.$element.data(b,null),this.$wrap.remove(),this._trigger("destory")}},c.defaults={namespace:b,skin:null,image:"images/defaults.png",lang:"en",repeat:{default_value:"repeat",values:["no-repeat","repeat","repeat-x","repeat-y"],tpl:function(){return'<div class="{{namespace}}-repeat"><span class="{{namespace}}-repeat-title">{{strings.bgRepeat}}</span><ul class="{{namespace}}-repeat-content"><li class="repeat_no-repeat"></li><li class="repeat_repeat"></li><li class="repeat_repeat-x"></li><li class="repeat_repeat-y"></li></ul></div>'}},position:{default_value:"top left",values:["top left","top center","top right","center left","center center","center right","bottom left","bottom center","bottom right"],tpl:function(){return'<div class="{{namespace}}-position"><span class="{{namespace}}-position-title">{{strings.bgPosition}}</span><ul class="{{namespace}}-position-content"><li class="postion_top-left"></li><li class="postion_top-center"></li><li class="postion_top-right"></li><li class="postion_center-left"></li><li class="postion_center-center"></li><li class="postion_center-right"></li><li class="postion_bottom-left"></li><li class="postion_bottom-center"></li><li class="postion_bottom-right"></li></ul></div>'}},size:{default_value:"auto",values:["auto","cover","contain","100% 100%"],tpl:function(){return'<div class="{{namespace}}-size"><span class="{{namespace}}-size-title">{{strings.bgSize}}</span><ul class="{{namespace}}-size-content"><li class="size_adapt-auto"></li><li class="size_adapt-width"></li><li class="size_adapt-height"></li><li class="size_adapt-all"></li></ul></div>'}},attachment:{namespace:"asDropdown",default_value:"scroll",values:["scroll","fixed","inherit"],tpl:function(){return'<div class="{{namespace}}-attachment"><span class="{{namespace}}-attachment-title">{{strings.bgAttach}}</span><div class="{{namespace}}-attachment-content"><div class="{{attachNamespace}} {{namespace}}-dropdown-trigger"><i class="asIcon-caret-down"></i></div><ul><li class="attachment_scroll">scroll</li><li class="attachment_fixed">fixed</li><li class="attachment_default">default</li></ul></div></div>'}},tpl:function(){return'<div class="{{namespace}}"><div class="{{namespace}}-initiate"><i></i>{{strings.placeholder}}</div><div class="{{namespace}}-info"><div class="{{namespace}}-info-image"><i></i><span class="{{namespace}}-info-image-name">{{strings.placeholder}}</span></div><div class="{{namespace}}-info-change">{{strings.change}}</div><a class="{{namespace}}-info-remove" href=""></a></div><div class="{{namespace}}-expand"><a class="{{namespace}}-expand-close" href="#"></a><div class="{{namespace}}-expand-image-wrap"><div class="{{namespace}}-expand-image"></div></div></div></div>'},process:function(a){return a&&"undefined"!=typeof a.image&&""!==a.image?JSON.stringify(a):""},parse:function(b){return b?a.parseJSON(b):{}},getThumbnalil:function(a){var b,c,d,e;return b=a.match(/([\S]+[\/])([\S]+)(\.+\w+$)/i),c=b[1],e=b[2],d=b[3],0===e.search("thumbnail")?c+e+d:c+"thumbnail-"+e+d},select:function(){},onChange:function(){},strings:{}},c.Strings={},c.localize=function(a,b){c.Strings[a]=b},c.localize("en",{placeholder:"Add Image",change:"change",bgRepeat:"Repeat",bgPosition:"Position",bgAttach:"Attach",bgSize:"Scalling"}),a.fn[b]=function(d){if("string"!=typeof d)return this.each(function(){a.data(this,b)||a.data(this,b,new c(this,d))});var e=d,f=Array.prototype.slice.call(arguments,1);if(/^\_/.test(e))return!1;if("val"!==e||0!==f.length)return this.each(function(){var c=a.data(this,b);c&&"function"==typeof c[e]&&c[e].apply(c,f)});var g=this.first().data(b);return g&&"function"==typeof g[e]?g[e].apply(g,f):void 0}}(jQuery,document,window);