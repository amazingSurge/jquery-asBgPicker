/*! jQuery asBgPicker - v0.1.0 - 2014-07-03
* https://github.com/amazingSurge/jquery-asBgPicker
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a,b,c,d){"use strict";var e="asBgPicker",f=a[e]=function(b,c){var e={};this.element=b,this.$element=a(b),this.name=this.$element.attr("name")?this.$element.attr("name"):c.name,this.options=a.extend({},f.defaults,c,this.$element.data(),e),this.namespace=this.options.namespace,this.components=a.extend(!0,{},this.components),this.classes={skin:this.namespace+"_"+this.options.skin,disabled:this.namespace+"_disabled",active:this.namespace+"_active",hide:this.namespace+"_hide",show:this.namespace+"_show",hasImage:this.namespace+"_hasImage"},this.disabled=!1,this.initialed=!1;var g=this;a.extend(g,{init:function(){g._createHtml(),g.options.skin&&g.$wrap.addClass(g.classes.skin),g._getValue(),g.options.disabled&&g.disable(),g.setImage(g.value.image),g.doSize.init(),g.doAttachment.init(),g.doPosition.init(),g.doRepeat.init(),g._bindEvent(),g.initialed=!0,g._trigger("ready")},_bindEvent:function(){g.$initiate.on("mouseenter",function(){g.disabled||(g.$actions.addClass(g.classes.show),g.$remove.addClass(g.classes.show))}).on("mouseleave",function(){g.disabled||(g.$actions.removeClass(g.classes.show),g.$remove.removeClass(g.classes.show))}),g.$actions.on("click",function(){g.disabled||(g.$initiate.addClass(g.classes.hide),g.$wrap.append(g.$extend),g.$extend.removeClass(g.classes.hide).addClass(g.classes.show))}),g.$remove.on("click",function(){return g.disabled?void 0:(g.clear(),!1)}),g.$close.on("click",function(){return g.disabled?void 0:(g.$extend.removeClass(g.classes.show).addClass(g.classes.hide),g.$initiate.removeClass(g.classes.hide),!1)}),g.$element.on("onChange",function(){g.disabled||g.options.onChange.call(g)}),g.$image.on("click",function(){g.disabled||g.options.onClickImage.call(g)})},_createHtml:function(){g.$wrap=a(g.options.tpl()),g.$extend=a(g.options.tpl_extend()),g.$element.after(g.$wrap),g.$initiate=g.$wrap.find("."+g.namespace+"-initiate"),g.$info=g.$initiate.find("."+g.namespace+"-image-info"),g.$remove=g.$wrap.find("."+g.namespace+"-remove"),g.$actions=g.$wrap.find("."+g.namespace+"-actions"),g.$close=g.$extend.find("."+g.namespace+"-close"),g.$image_wrap=g.$extend.find("."+g.namespace+"-image-wrap"),g.$image=g.$extend.find("."+g.namespace+"-image")},_trigger:function(a){g.$element.trigger("asBgPicker::"+a,g),g.$element.trigger(a+".asBgPicker",g),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var b="on"+a,c=arguments.length>1?Array.prototype.slice.call(arguments,1):d;"function"==typeof g.options[b]&&g.options[b].apply(g,c)},_getValue:function(){var a=g.$element.val();return a?void(g.value=g.options.parse(a)):g.value=""},_setState:function(a){a&&a!==g.options.image?g.$initiate.addClass(g.classes.hasImage):g.$initiate.removeClass(g.classes.hasImage)},_returnInfo:function(b){var c;b&&b!==g.options.image?(c=b.match(/([\S]+[\/])([\S]+\w+$)/i)[2],a(g.$info)[0].lastChild.nodeValue=c):a(g.$info)[0].lastChild.nodeValue="Add Image"},_process:function(){(null===g.value||"undefined"===g.value.image)&&(g.value={}),g.options.onChange.call(g,g.value),g.$element.val(g.options.process(g.value))},doRepeat:{init:function(){var b=this;this.repeat=g.value.repeat?g.value.repeat:g.options.repeat.default_value;var c=g.options.repeat.tpl().replace(/namespace/g,g.namespace);this.$tpl_repeat=a(c),g.$image_wrap.after(this.$tpl_repeat),this.$repeat=g.$extend.find("."+g.namespace+"-repeat"),this.$items=this.$repeat.find("li"),this.repeatValues=g.options.repeat.values,a.each(this.repeatValues,function(a,c){b.$items.eq(a).data("repeat",c)}),this.set(this.repeat),this.bindEvent()},set:function(a){this.$items.removeClass(g.classes.active);for(var b=0;b<this.repeatValues.length;b++)a===this.repeatValues[b]&&(g.value.repeat=a,this.$items.eq(b).addClass(g.classes.active));g.$image.css({"background-repeat":a})},bindEvent:function(){var b=this;this.$repeat.on("click","li",function(){if(!g.disabled){var c=a(this).data("repeat");return b.set(c),g._process(),!1}})}},doPosition:{init:function(){var b=this;this.position=g.value.position?g.value.position:g.options.position.default_value;var c=g.options.position.tpl().replace(/namespace/g,g.namespace);this.$tpl_position=a(c),g.$image_wrap.after(this.$tpl_position),this.$position=g.$extend.find("."+g.namespace+"-position"),this.$items=this.$position.find("li"),this.positionValues=g.options.position.values,a.each(this.positionValues,function(a,c){b.$items.eq(a).data("position",c)}),this.set(this.position),this.bindEvent()},set:function(a){this.$items.removeClass(g.classes.active);for(var b=0;b<this.positionValues.length;b++)a===this.positionValues[b]&&(g.value.position=a,this.$items.eq(b).addClass(g.classes.active));g.$image.css({"background-position":a})},bindEvent:function(){var b=this;this.$position.on("click","li",function(){if(!g.disabled){var c=a(this).data("position");return b.set(c),g._process(),!1}})}},doSize:{init:function(){var b=this;this.size=g.value.size?g.value.size:g.options.size.default_value;var c=g.options.size.tpl().replace(/namespace/g,g.namespace);this.$tpl_size=a(c),g.$image_wrap.after(this.$tpl_size),this.$size=g.$extend.find("."+g.namespace+"-size"),this.$items=this.$size.find("li"),this.sizeValues=g.options.size.values,a.each(this.sizeValues,function(a,c){b.$items.eq(a).data("size",c)}),this.set(this.size),this.bindEvent()},set:function(a){this.$items.removeClass(g.classes.active);for(var b=0;b<this.sizeValues.length;b++)a===this.sizeValues[b]&&(g.value.size=a,this.$items.eq(b).addClass(g.classes.active));g.$image.css({"background-size":a})},bindEvent:function(){var b=this;this.$size.on("click","li",function(){if(!g.disabled){var c=a(this).data("size");return b.set(c),g._process(),!1}})}},doAttachment:{init:function(){var b=this;this.attachment=g.value.attachment?g.value.attachment:g.options.attachment.default_value;var c=g.options.attachment.tpl().replace(/otherNamespace/g,g.options.attachment.namespace).replace(/namespace/g,g.namespace);this.$tpl_attachment=a(c),g.$image_wrap.after(this.$tpl_attachment),this.$attachment=g.$extend.find("."+g.namespace+"-attachment"),this.$items=this.$attachment.find("li"),this.$dropdown=g.$extend.find("."+g.options.attachment.namespace),this.attachmentValues=g.options.attachment.values,a.each(this.attachmentValues,function(a,c){b.$items.eq(a).data("attachment",c)}),this.$dropdown.asDropdown({namespace:g.options.attachment.namespace,imitateSelect:!0,data:"attachment",onChange:function(a){g.disabled||(g.value.attachment=a,g._process(),g.$image.css({"background-attachment":g.value.attachment}))}}),this.set(this.attachment)},set:function(a){this.$dropdown.data("asDropdown").set(a)}}}),this._trigger("init"),this.init()};f.prototype={constructor:f,components:{},val:function(a,b){return"undefined"==typeof a?this.value:void(a?this.set(a,b):this.clear(b))},set:function(a,b){var c=this;b!==!1&&(c.value=a,c.setImage(a.image),c.doRepeat.set(a.repeat),c.doSize.set(a.size),c.doPosition.set(a.position),c.doAttachment.set(a.attachment),c._process(),c.options.onChange.call(c,a))},clear:function(a){var b=this;if(b.value=null,a!==!1){var c="",d="",e="",f="",g="";b.setImage(c),b.doRepeat.set(d),b.doSize.set(g),b.doPosition.set(e),b.doAttachment.set(f),b._process(),b.options.onChange.call(b,b.value)}},setImage:function(a){var b,c=this;if(c._setState(a),c._returnInfo(a),""===a||"undefined"==typeof a)return void c.$image.css({"background-image":"none"});if(a||a!==c.options.image){b=c.options.getThumbnalil(a);var d=new Image;d.onload=function(){c.value.image=b,c._returnInfo(c.value.image),c._process(),c.$image.css({"background-image":'url("'+c.value.image+'")'})},d.onerror=function(){c.value.image=a,c._returnInfo(a),c._process(),c.$image.css({"background-image":"none"})},d.src=b}},setRepeat:function(a){this.repeat=a,this.doRepeat.set(a),this._process()},setSize:function(a){this.size=a,this.doSize.set(a),this._process()},setPosition:function(a){this.position=a,this.doPosition.set(a),this._process()},setAttachment:function(a){this.attachment=a,this.doAttachment.set(a),this._process()},enable:function(){this.disabled=!1,this.$wrap.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrap.addClass(this.classes.disabled)},destory:function(){this.$element.data(e,null),this.$wrap.remove(),this._trigger("destory")}},f.defaults={namespace:e,skin:null,name:null,image:"images/defaults.png",repeat:{default_value:"repeat",values:["no-repeat","repeat","repeat-x","repeat-y"],tpl:function(){return'<div class="namespace-repeat"><span class="namespace-repeat-title">Repeat</span><ul class="namespace-repeat-content"><li class="repeat_no-repeat"></li><li class="repeat_repeat"></li><li class="repeat_repeat-x"></li><li class="repeat_repeat-y"></li></ul></div>'}},position:{default_value:"top left",values:["top left","top center","top right","center left","center center","center right","bottom left","bottom center","bottom right"],tpl:function(){return'<div class="namespace-position"><span class="namespace-position-title">Position</span><ul class="namespace-position-content"><li class="postion_top-left"></li><li class="postion_top-center"></li><li class="postion_top-right"></li><li class="postion_center-left"></li><li class="postion_center-center"></li><li class="postion_center-right"></li><li class="postion_bottom-left"></li><li class="postion_bottom-center"></li><li class="postion_bottom-right"></li></ul></div>'}},size:{default_value:"auto",values:["auto","cover","contain","100% 100%"],tpl:function(){return'<div class="namespace-size"><span class="namespace-size-title">Scalling</span><ul class="namespace-size-content"><li class="size_adapt-auto"></li><li class="size_adapt-width"></li><li class="size_adapt-height"></li><li class="size_adapt-all"></li></ul></div>'}},attachment:{namespace:"asDropdown",default_value:"scroll",values:["scroll","fixed","inherit"],tpl:function(){return'<div class="namespace-attachment"><span class="namespace-attachment-title">Attach</span><div class="namespace-attachment-content"><div class="otherNamespace namespace-dropdown-trigger"><i class="asIcon-caret-down"></i></div><ul><li class="attachment_scroll">scroll</li><li class="attachment_fixed">fixed</li><li class="attachment_default">default</li></ul></div></div>'}},tpl:function(){return'<div class="'+this.namespace+'"><div class="'+this.namespace+'-initiate"><div class="'+this.namespace+'-image-info"><span></span>Add Image</div><div class="'+this.namespace+'-actions">Change</div><a class="'+this.namespace+'-remove" href=""></a></div></div>'},tpl_extend:function(){return'<div class="'+this.namespace+'-extend"><a class="'+this.namespace+'-close" href="#"></a><div class="'+this.namespace+'-image-wrap"><div class="'+this.namespace+'-image"></div></div></div>'},process:function(a){return a?JSON.stringify(a):""},parse:function(b){return b?a.parseJSON(b):null},getThumbnalil:function(a){var b,c,d,e;return b=a.match(/([\S]+[\/])([\S]+)(\.+\w+$)/i),c=b[1],e=b[2],d=b[3],0===e.search("thumbnail")?c+e+d:c+"thumbnail-"+e+d},onChange:function(){},onClickImage:function(){}},f.registerComponent=function(a,b){f.prototype.components[a]=b},a.fn[e]=function(b){if("string"!=typeof b)return this.each(function(){a.data(this,e)||a.data(this,e,new f(this,b))});var c=b,g=arguments.length>1?Array.prototype.slice.call(arguments,1):d;if(/^\_/.test(c))return!1;if(!(/^(getTabs)$/.test(c)||"val"===c&&g===d))return this.each(function(){var b=a.data(this,e);b&&"function"==typeof b[c]&&b[c].apply(b,g)});var h=this.first().data(e);return h&&"function"==typeof h[c]?h[c].apply(h,g):void 0}}(jQuery,document,window);